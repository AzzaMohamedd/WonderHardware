@model BLL.ViewModel.CheckOutVM
@{
    ViewData["Title"] = "CheckOut";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <title>Electro - HTML Ecommerce Template</title>

    <!-- Google font -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,500,700" rel="stylesheet">

    <!-- Bootstrap -->
    <link type="text/css" rel="stylesheet" href="~/css/bootstrap.min.css" />

    <!-- Slick -->
    <link type="text/css" rel="stylesheet" href="~/css/slick.css" />
    <link type="text/css" rel="stylesheet" href="~/css/slick-theme.css" />

    <!-- nouislider -->
    <link type="text/css" rel="stylesheet" href="~/css/nouislider.min.css" />

    <!-- Font Awesome Icon -->
    <link rel="stylesheet" href="~/css/font-awesome.min.css">

    <!-- Custom stlylesheet -->
    <link type="text/css" rel="stylesheet" href="~/css/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-sweetalert/1.0.1/sweetalert.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-sweetalert/1.0.1/sweetalert.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-sweetalert/1.0.1/sweetalert.min.css.map" rel="stylesheet" />
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>

    <!-- BREADCRUMB -->
    <div id="breadcrumb" class="section">
        <!-- container -->
        <div class="container">
            <!-- row -->
            <div class="row">
                <div class="col-md-12">
                    <h3 class="breadcrumb-header">Checkout</h3>
                    <ul class="breadcrumb-tree">
                        <li><a href="/Home/Index">Home</a></li>
                        <li class="active">Checkout</li>
                    </ul>
                </div>
            </div>
            <!-- /row -->
        </div>
        <!-- /container -->
    </div>
    <!-- /BREADCRUMB -->
    <!-- SECTION -->
    <div class="section">
        <!-- container -->
        <div class="container">
            <!-- row -->
            <div class="row">

                <div class="col-md-7">
                    <!-- Billing Details -->
                    <div class="billing-details">
                        <div class="section-title">
                            <h3 class="title">Billing address</h3>
                        </div>
                        <div class="form-group">
                            <div class="input-radio">
                                <input type="radio" id="create-account" name="exampleRadios" value="option1" checked />
                                <label for="create-account">
                                    <span></span>
                                    <strong>Create New Account</strong>
                                </label>

                                <div class="caption" id="createAccDiv">
                                    <div class="form-group">
                                        <input id="fname" class="input" type="text" placeholder="First Name">
                                    </div>
                                    <div class="form-group">
                                        <input id="lname" class="input" type="text" placeholder="Last Name">
                                    </div>
                                    <div class="form-group">
                                        <input id="telephone1" class="input" type="tel" placeholder="Telephone">
                                    </div>
                                    <div class="form-group">
                                        <input id="password1" class="input" type="password" placeholder="Password">
                                    </div>
                                    <div class="form-group">
                                        <input id="city1" class="input" type="text" placeholder="City">
                                    </div>
                                    <div class="form-group">
                                        <input id="address1" class="input" type="text" placeholder="Address">
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="form-group">
                            <div class="input-radio">
                                <input type="radio" id="have-account" name="exampleRadios" value="option2">
                                <label for="have-account">
                                    <span></span>
                                    <strong>Already have an Account</strong>
                                </label>

                                <div class="caption" id="haveAccDiv">
                                    <div class="form-group">
                                        <input id="telephone2" class="input" type="tel" placeholder="Telephone">
                                    </div>
                                    <div class="form-group">
                                        <input id="password2" class="input" type="password" placeholder="Password">
                                    </div>
                                    <div class="form-group">
                                        <div class="input-checkbox">
                                            <input type="checkbox" id="another-address">
                                            <label for="another-address">
                                                <span></span>
                                                add another address
                                            </label>
                                            <div class="caption">
                                                <div class="form-group">
                                                    <input id="city2" class="input" type="text" placeholder="City">
                                                </div>
                                                <div class="form-group">
                                                    <input id="address2" class="input" type="text" placeholder="Address">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- /Billing Details -->
                    <!-- Order notes -->
                    <!--<div class="order-notes">
                        <textarea class="input" placeholder="Order Notes"></textarea>
                    </div>-->
                    <!-- /Order notes -->
                </div>

                <!-- Order Details -->
                <div class="col-md-5 order-details">
                    <div class="section-title text-center">
                        <h3 class="title">Your Order</h3>
                    </div>
                    <div class="dbody">
                        <div class="order-summary">
                            <div class="order-col">
                                <div><strong>PRODUCT</strong></div>
                                <div><strong>TOTAL</strong></div>
                            </div>
                            <div class="order-products">
                                <div class="order-col">
                                    <div style="width:100%" id="ProductsDiv">

                                    </div>
                                </div>
                            </div>
                            <div class="order-col">
                                <div>Shiping</div>
                                <div><strong>FREE</strong></div>
                            </div>
                            <div class="order-col" style="color: #D10024">
                                <div><strong>TOTAL</strong> (<span id="TQuantity"></span>)</div>
                                <div><strong id="TPrice" class="order-total"></strong> LE</div>
                            </div>
                        </div>
                        <div class="payment-method">
                            <div class="input-radio">
                                <input type="radio" name="payment" id="payment-1">
                                <label for="payment-1">
                                    <span></span>
                                    Direct Bank Transfer
                                </label>
                                <div class="caption">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                                </div>
                            </div>
                            <div class="input-radio">
                                <input type="radio" name="payment" id="payment-2">
                                <label for="payment-2">
                                    <span></span>
                                    Cheque Payment
                                </label>
                                <div class="caption">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                                </div>
                            </div>
                            <div class="input-radio">
                                <input type="radio" name="payment" id="payment-3">
                                <label for="payment-3">
                                    <span></span>
                                    Paypal System
                                </label>
                                <div class="caption">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                                </div>
                            </div>
                        </div>
                        <div class="input-checkbox">
                            <input type="checkbox" id="terms">
                            <label for="terms">
                                <span></span>
                                I've read and accept the <a href="#" data-toggle="modal" data-target="#exampleModalLong">terms & conditions</a>
                            </label>
                        </div>

                        <!-- Modal -->
                        <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLongTitle">terms & conditions</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.

                                        Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.

                                        Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.

                                        Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.

                                        Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.

                                        Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.

                                        Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.

                                        Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.

                                        Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.

                                        Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.

                                        Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.

                                        Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.

                                        Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.

                                        Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.

                                        Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.

                                        Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.

                                        Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.

                                        Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <button id="btnaccept" type="button" data-dismiss="modal" class="btn btn-primary">I've read and accept</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button id="btnOrder" class="primary-btn btn-block order-submit" style="background-color:darkgray" disabled="">Place order</button>
                    </div>
                    
                </div>
                <!-- /Order Details -->
            </div>
            <!-- /row -->
        </div>
        <!-- /container -->
    </div>
    <!-- /SECTION -->
    <!-- jQuery Plugins -->
    <script src="~/js/jquery.min.js"></script>
    <script src="~/js/bootstrap.min.js"></script>
    <script src="~/js/slick.min.js"></script>
    <script src="~/js/nouislider.min.js"></script>
    <script src="~/js/jquery.zoom.min.js"></script>
    <script src="~/js/main.js"></script>
    <script>
        //Order from cart
        var z = getItemStorage("Cart") || [];
        var arr = [];
        var dataArr = [];
        var userArr;
        $(document).ready(function () {
            var html = '';
            var totalprice = 0.00;
            var totalproducts = 0;
            if (z.length == 0) {
                debugger;
                html += '<img src="/img/Index/download.png" style="border-radius: 50%;width: 100px;margin-left: auto;margin-right: auto;display: block;"/>';
                html += '<br/><div style="text-align: center;display: block;"><strong>Your cart is empty</strong></div><br/>';
                html += '<a class="primary-btn order-submit" href="/Home/Index" style="margin-left: auto;margin-right: auto;display: block;width: 55%;">Start Shopping</a>';
                $('.dbody').html(html);
            }
            else {
                $.each(z, function (key, item) {
                    arr[key] = { ProductCode: item.Code, ProductQuantity: item.Quantity, TotalPrice: (item.Price * item.Quantity) };
                    totalprice = totalprice + (item.Quantity * item.Price);
                    totalproducts = totalproducts + (item.Quantity * 1);

                    html += '<tr style="display: flex; justify-content: space-between;">';
                    html += '<th style="text-align: left;"><span style="color:#D10024;">' + item.Quantity + ' X </span>' + item.Name + '</th>';
                    html += '<th style="text-align: right;">' + (item.Price * item.Quantity) + '</th>';
                    html += '</tr>';

                    $('#ProductsDiv').html(html);

                });

            }
            $('#TPrice').html(totalprice);
            $('#TQuantity').html(totalproducts);
            //end order from cart

            $("#haveAccDiv").hide();
            $("#have-account").click(function () {
                $("#haveAccDiv").show(1000);
                $("#createAccDiv").hide(1000);
                ClearCreateAccDiv();
            });
            $("#create-account").click(function () {
                $('#another-address').prop('checked', false);
                $('#another-telephone').prop('checked', false);
                $("#haveAccDiv").hide(1000);
                $("#createAccDiv").show(1000);
                ClearHaveAccDiv();
            });
            $('#btnOrder').click(function () {
                var fname = $('#fname').val();
                var lname = $('#lname').val();
                var telephone1 = $('#telephone1').val();
                var password1 = $('#password1').val();
                var city1 = $('#city1').val();
                var address1 = $('#address1').val();
                var telephone2 = $('#telephone2').val();
                var password2 = $('#password2').val();
                var city2 = $('#city2').val();
                var address2 = $('#address2').val();
                debugger;
                
                if (telephone1 == "" && telephone2=="") {
                    //swal({
                    //    icon: 'error',
                    //    title: 'Please log in or Create a new account !!',
                    //    html: $('<div>')
                    //        .addClass('some-class')
                    //        .text('jQuery is everywhere.'),
                    //    animation: false,
                    //    customClass: 'animated tada'
                    //})
                    Swal.fire({
                        icon: 'error',
                        title: 'Please log in or Create a new account !!',
                        showConfirmButton: false,
                        timer: 1500
                    })
                }
                else if (telephone2 == "" && password2 == "" && city2 == "" && address2 == "") {
                    //create Account
                    debugger;
                    $.each(arr, function (key, item) {
                        dataArr[key] = { City: city1, Address: address1, ProductCode: item.ProductCode, ProductQuantity: item.ProductQuantity, TotalPrice: item.TotalPrice };
                    });
                    userArr = { FName: fname, LName: lname, Telephone: telephone1, Password: password1 }
                    debugger;
                    $.ajax({
                        type: "POST",
                        url: "/Home/CheckOut",
                        data: { UserData: userArr, OrderData: dataArr },
                        datatype: "json",
                        success: function (result) {
                            if (result == "success") {
                                toastr.success('Account has been created & Order checked successfully.', '', { timeOut: 7000 });
                                //    window.location = "/Admin/Admin/Index"
                            }
                            else {
                                toastr.error('Something wrong , please try again !!', '', { timeOut: 7000 });

                            }
                        }
                    });
                }
                else {
                    //already have Account
                    $.each(arr, function (key, item) {
                        dataArr[key] = { City: city2, Address: address2, ProductCode: item.ProductCode, ProductQuantity: item.ProductQuantity, TotalPrice: item.TotalPrice };
                    });
                    userArr = {Telephone: telephone2 ,Password: password2}
                    debugger;
                    $.ajax({
                        type: "POST",
                        url: "/Home/CheckOut" ,
                        data: { UserData: userArr, OrderData: dataArr },
                        dataType: "json",
                        success: function (result) {
                            if (result == "success checked new address") {
                                toastr.success('Order checked successfully at the address you entered.', '', { timeOut: 7000 });
                                //    window.location = "/Admin/Admin/Index"
                            }
                            else if (result == "success checked old address") {
                                toastr.success('Order checked successfully at the same address checked before.', '', { timeOut: 7000 });
                            }
                            else if (result == "failed phone&pass") {
                                toastr.error('Phone or password is not correct or both!!', '', { timeOut: 7000 });
                            }
                        }
                    });
                }

            });

            $('#terms').click(function () {
                if ($("#btnOrder").is(':disabled')) {
                    $("#btnOrder").removeAttr('disabled');
                    $("#btnOrder").css('background-color', '#D10024');
                }
                else {
                    $("#btnOrder").attr('disabled', 'disabled');
                    $("#btnOrder").css('background-color', 'darkgray');
                    $("#terms").removeAttr('checked');
                }
            });
            $('#btnaccept').click(function () {
                if ($("#btnOrder").is(':disabled')) {
                    $('#terms').prop('checked', true);
                    $("#btnOrder").removeAttr('disabled');
                    $("#btnOrder").css('background-color', '#D10024');
                    
                }
                
                
            });

        });
        function ClearCreateAccDiv() {
            setTimeout(function () {
                $('#fname').val('');
                $('#lname').val('');
                $('#address1').val('');
                $('#city1').val('');
                $('#telephone1').val('');
                $('#password1').val('');
            }, 1000);
        }
        function ClearHaveAccDiv() {
            setTimeout(function () {
                $('#password2').val('');
                $('#address2').val('');
                $('#city2').val('');
                $('#telephone2').val('');
            }, 1000);
        }

        function setItemStorage(itemKey, itemValue) {
            localStorage.setItem(itemKey, JSON.stringify(itemValue));
        }
        function getItemStorage(itemKey) {
            return JSON.parse(localStorage.getItem(itemKey));
        }
    </script>
</body>
</html>