@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

@{
    ViewData["Title"] = "CheckOut";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var Userid = HttpContextAccessor.HttpContext.Session.GetInt32("UserID");
    var Username = HttpContextAccessor.HttpContext.Session.GetString("UserName");

    var UserPhone = ViewBag.UserPhone;
    var UserAddress = ViewBag.UserAddress;


}

<!DOCTYPE html>
<html lang="en">
<body>
    <input hidden id="inputHidden" value="@Userid"/>
    <!-- BREADCRUMB -->
    <div id="breadcrumb" class="section">
        <!-- container -->
        <div class="container">
            <!-- row -->
            <div class="row">
                <div class="col-md-12">
                    <h3 class="breadcrumb-header">Checkout</h3>
                    <ul class="breadcrumb-tree">
                        <li><a href="/Home/Index">Home</a></li>
                        <li class="active">Checkout</li>
                    </ul>
                </div>
            </div>
            <!-- /row -->
        </div>
        <!-- /container -->
    </div>
    <!-- /BREADCRUMB -->
    <!-- SECTION -->
    <div class="section">
        <!-- container -->
        <div class="container">
            <!-- row -->
            <div class="row">

                <div class="col-md-7">
                    <!-- Billing Details -->
                    <div class="billing-details">
                        <div class="section-title">
                            <h3 class="title">Billing Information</h3>
                        </div>
                        @if (Userid == null)
                        {
                            <div id="bigBlock">
                                <div class="form-group">
                                    <div class="input-radio">
                                        <input type="radio" id="create-account" name="exampleRadios" value="option1" checked />
                                        <label for="create-account">
                                            <span></span>
                                            <strong>Create New Account</strong>
                                        </label>

                                        <div class="caption" id="createAccDiv">
                                            <div class="form-group">
                                                <input id="fname" class="input" type="text" placeholder="First Name" autocomplete="off">
                                                <span id="validfname" style="display: none; font-size: 13px; color: #D10024">Required field</span>
                                            </div>
                                            <div class="form-group">
                                                <input id="lname" class="input" type="text" placeholder="Last Name" autocomplete="off">
                                                <span id="validlname" style="display: none; font-size: 13px; color: #D10024">Required field</span>
                                            </div>
                                            <div class="form-group">
                                                <input id="telephone1" class="input" type="tel" placeholder="Telephone" autocomplete="off">
                                                <span id="validphone21" style="display: none; font-size: 13px; color: #D10024">Required field</span>
                                                <span id="validphone22" style="display: none; font-size: 13px; color: #D10024">This phone is already Exist !!</span>
                                            </div>
                                            <div class="form-group">
                                                <input id="password1" class="input" type="password" placeholder="Password" autocomplete="off">
                                                <span id="validpassword21" style="display: none; font-size: 13px; color: #D10024">Required field</span>
                                            </div>
                                            <div class="form-group">
                                                <input id="city1" class="input" type="text" placeholder="City" autocomplete="off">
                                                <span id="validcity21" style="display: none; font-size: 13px; color: #D10024">Please enter your City</span>
                                            </div>
                                            <div class="form-group">
                                                <input id="address1" class="input" type="text" placeholder="Address" autocomplete="off">
                                                <span id="validaddress21" style="display: none; font-size: 13px; color: #D10024">Please enter your Address</span>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="input-radio">
                                        <input type="radio" id="have-account" name="exampleRadios" value="option2">
                                        <label for="have-account">
                                            <span></span>
                                            <strong>Already have an Account</strong>
                                        </label>

                                        <div class="caption" id="haveAccDiv" hidden>
                                            <div class="form-group">
                                                <input id="telephone2" class="input" type="tel" placeholder="Telephone" autocomplete="off">
                                                <span id="validphone11" style="display: none; font-size: 13px; color: #D10024">Please enter your Phone</span>
                                                <span id="validphone12" style="display: none; font-size: 13px; color: #D10024">This Phone isn’t Exist !!</span>
                                            </div>
                                            <div class="form-group">
                                                <input id="password2" class="input" type="password" placeholder="Password" autocomplete="off">
                                                <span id="validpassword11" style="display: none; font-size: 13px; color: #D10024">Please enter your Password</span>
                                                <span id="validpassword12" style="display: none; font-size: 13px; color: #D10024">Password is Wrong , Try again..</span>
                                            </div>
                                            <button id="btncheckAcc" class="primary-btn order-submit">Check Account</button>

                                        </div>

                                    </div>
                                </div>
                            </div>

                            <div hidden id="checkedAccSuccess">
                                <div hidden id="checkedBefore">
                                    <div>
                                        <div>Name: <span id="name" style="color: #D10024"></span></div>
                                        <div>Phone: <span id="phone" style="color: #D10024"></span></div>
                                        You checked before to : <span style="color: #D10024" id="oldAddress"></span>
                                        <br />
                                        <div style="margin-top: 45px;">Do you want to checkout to the same address?</div> Or
                                    </div>
                                    <div class="form-group" id="addanotherAddress">
                                        <div class="input-checkbox">
                                            <input type="checkbox" id="another-address">
                                            <label for="another-address">
                                                <span></span>
                                                add another address
                                            </label>
                                            <div class="caption">
                                                <div class="form-group">
                                                    <input id="city2" class="input" type="text" placeholder="City" autocomplete="off">
                                                </div>
                                                <div class="form-group">
                                                    <input id="address2" class="input" type="text" placeholder="Address" autocomplete="off">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div hidden id="addAddress" class="caption">
                                    <div>Name: <span id="name2" style="color: #D10024"></span></div>
                                    <div>Phone: <span id="phone2" style="color: #D10024"></span></div>
                                    <br />
                                    <div class="form-group" style="margin-top: 45px;">
                                        <input id="city5" class="input" type="text" placeholder="City" autocomplete="off">
                                        <span id="validcity5" style="display: none; font-size: 13px; color: #D10024">Required field</span>

                                    </div>
                                    <div class="form-group">
                                        <input id="address5" class="input" type="text" placeholder="Address" autocomplete="off">
                                        <span id="validaddress5" style="display: none; font-size: 13px; color: #D10024">Required field</span>

                                    </div>
                                </div>
                                <input hidden id="addressOrNot" />
                            </div>
                        }
                        else
                        {
                            <img src="/img/Index/user-1.svg" style="border-radius: 50%;width: 100px;margin-left: auto;margin-right: auto;display: block;" />
                            <div style="text-align: center; margin-left: auto; margin-right: auto;">@Username</div>
                            <div style="text-align: center; margin-left: auto; margin-right: auto;">@UserPhone</div>
                            @if (UserAddress != null)
                            {
                                <div>
                                    The order will be delivered to the address : @UserAddress
                                </div>
                                <div class="form-group">
                                    <div class="input-checkbox">
                                        <input autocomplete="off" type="checkbox" id="another-address">
                                        <label for="another-address">
                                            <span></span>
                                            Do you want to add another address?
                                        </label>
                                        <div class="caption">
                                            <div class="form-group">
                                                <input id="city3" autocomplete="off" class="input" type="text" placeholder="City">
                                            </div>
                                            <div class="form-group">
                                                <input id="address3" autocomplete="off" class="input" type="text" placeholder="Address">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                            else
                            {
                                <div class="caption">
                                    <div class="form-group">
                                        <input id="city4" autocomplete="off" class="input" type="text" placeholder="City">
                                        <span id="validcity4" style="display: none; font-size: 13px; color: #D10024">Required field</span>
                                    </div>
                                    <div class="form-group">
                                        <input id="address4" autocomplete="off" class="input" type="text" placeholder="Address">
                                        <span id="validaddress4" style="display: none; font-size: 13px; color: #D10024">Required field</span>
                                    </div>
                                </div>

                            }
                        }

                    </div>
                    <!-- /Billing Details -->
                    <!-- Order notes -->
                    <!--<div class="order-notes">
                        <textarea class="input" placeholder="Order Notes"></textarea>
                    </div>-->
                    <!-- /Order notes -->
                </div>

                <!-- Order Details -->
                <div class="col-md-5 order-details">
                    <div class="section-title text-center">
                        <h3 class="title">Your Order</h3>
                    </div>
                    <div class="dbody">
                        <div class="order-summary">
                            <div class="order-col">
                                <div><strong>PRODUCT</strong></div>
                                <div><strong>TOTAL</strong></div>
                            </div>
                            <div class="order-products">
                                <div class="order-col">
                                    <div style="width:100%" id="ProductsDiv">

                                    </div>
                                </div>
                            </div>
                            <div class="order-col">
                                <div>Shiping</div>
                                <div><strong>FREE</strong></div>
                            </div>
                            <div class="order-col" style="color: #D10024">
                                <div><strong>TOTAL</strong> (<span id="TQuantity"></span>)</div>
                                <div><strong id="TPrice" class="order-total"></strong> LE</div>
                            </div>
                        </div>
                        <div class="payment-method">
                            <div class="input-radio">
                                <input type="radio" name="payment" id="payment-1">
                                <label for="payment-1">
                                    <span></span>
                                    Direct Bank Transfer
                                </label>
                                <div class="caption">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                                </div>
                            </div>
                            <div class="input-radio">
                                <input type="radio" name="payment" id="payment-2">
                                <label for="payment-2">
                                    <span></span>
                                    Cheque Payment
                                </label>
                                <div class="caption">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                                </div>
                            </div>
                            <div class="input-radio">
                                <input type="radio" name="payment" id="payment-3">
                                <label for="payment-3">
                                    <span></span>
                                    Paypal System
                                </label>
                                <div class="caption">
                                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
                                </div>
                            </div>
                        </div>
                        <div id="divterms" class="input-checkbox">
                            <input type="checkbox" id="terms">
                            <label for="terms">
                                <span></span>
                                I've read and accept the <a href="#" data-toggle="modal" data-target="#exampleModalLong">terms & conditions</a>
                            </label>
                        </div>

                        <!-- Modal -->
                        <div class="modal fade" id="exampleModalLong" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLongTitle">terms & conditions</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.

                                        Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.

                                        Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.

                                        Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.

                                        Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.

                                        Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.

                                        Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.

                                        Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.

                                        Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.

                                        Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.

                                        Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.

                                        Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.

                                        Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.

                                        Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.

                                        Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.

                                        Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.

                                        Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis lacus vel augue laoreet rutrum faucibus dolor auctor.

                                        Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus auctor fringilla.
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        <button id="btnaccept" type="button" data-dismiss="modal" class="btn btn-primary">I've read and accept</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button id="btnOrder" class="primary-btn btn-block order-submit" style="background-color:darkgray" disabled="">Place order</button>
                    </div>

                </div>
                <!-- /Order Details -->
            </div>
            <!-- /row -->
        </div>
        <!-- /container -->
    </div>
    <!-- /SECTION -->
    <!-- jQuery Plugins -->
    <script src="~/js/jquery.min.js"></script>
    <script>
        //Order from cart
        var z = getItemStorage("Cart") || [];
        var arr = [];
        var avaialbleData = [];
        var nonavaialbleData = [];
        var dataArr = [];
        var userArr;
        $(document).ready(function () {
            var html = '';
            var totalprice = 0.00;
            var totalproducts = 0;
            //i is the Counter of Available Product
            var i = 0,j=0;
            if (z.length == 0) {
                html += '<img src="/img/Index/download.png" style="border-radius: 50%;width: 100px;margin-left: auto;margin-right: auto;display: block;"/>';
                html += '<br/><div style="text-align: center;display: block;"><strong>Your cart is empty</strong></div><br/>';
                html += '<a class="primary-btn order-submit" href="/Home/Index" style="margin-left: auto;margin-right: auto;display: block;width: 55%;">Start Shopping</a>';
                $('.dbody').html(html);
            }
            else {
                $.ajax({
                    type: "GET",
                    url: "/Home/GetAvailableProducts",
                    dataType: "json",
                    success: function (result) {
                        $.each(result, function (key, item) {
                            avaialbleData[key] = item;
                        });
                        $.each(z, function (key, item) {
                            if (avaialbleData[item.Code].isAvailable == "Available") {
                                if (avaialbleData[item.Code].quantity > 0) {
                                    arr[i] = { ProductCode: item.Code, ProductQuantity: item.Quantity, TotalPrice: (avaialbleData[item.Code].productPrice * item.Quantity) };
                                    i++;
                                    totalprice = totalprice + (item.Quantity * avaialbleData[item.Code].productPrice);
                                    totalproducts = totalproducts + (item.Quantity * 1);

                                    html += '<tr style="display: flex; justify-content: space-between;">';
                                    html += '<th style="text-align: left;"><span style="color:#D10024;">' + item.Quantity + ' X </span>' + avaialbleData[item.Code].productName + '</th>';
                                    html += '<th style="text-align: right;">' + (avaialbleData[item.Code].productPrice * item.Quantity) + '</th>';
                                    html += '</tr>';
                                    $('#ProductsDiv').html(html);
                                }
                                else {
                                    nonavaialbleData[j] = { Code: item.Code, Quantity: item.Quantity };
                                    j++;
                                }

                            }
                        });
                        $('#TPrice').html(totalprice);
                        $('#TQuantity').html(totalproducts);
                    }

                });
                
            }
            
            //end order from cart

            $("#have-account").click(function () {
                $("#haveAccDiv").show(1000);
                $("#createAccDiv").hide(1000);
                $('#btnOrder').hide();
                $('#divterms').hide();
                ClearCreateAccDiv();
            });
            $("#create-account").click(function () {
                $('#another-address').prop('checked', false);
                $('#another-telephone').prop('checked', false);
                $("#haveAccDiv").hide(1000);
                $("#createAccDiv").show(1000);
                $('#btnOrder').show();
                $('#divterms').show();
                ClearHaveAccDiv();
            });
            $('#btncheckAcc').click(function () {
                HideAllValidations();
                var telephone2 = $('#telephone2').val();
                var password2 = $('#password2').val();
                if (telephone2 == "" || telephone2 == undefined) {
                    $('#validphone11').show();
                }
                if (password2 == "" || password2 == undefined) {
                    $('#validpassword11').show();
                }
                else {
                    $.ajax({
                        type: "GET",
                        url: "/Home/CheckAccount?Telephone=" + telephone2 + "&Password=" + password2,
                        dataType: "json",
                        success: function (result) {
                            if (result == "failed phone") {
                                $("#validphone12").show();
                            }
                            else if (result == "failed password") {
                                $("#validpassword12").show();
                            }
                            else if (result["Address"] == null) {
                                //account exist & must add address
                                $('#btncheckAcc').hide();
                                $('#checkedAccSuccess').show();
                                $('#addAddress').show();
                                $('#bigBlock').hide();
                                $('#name2').text(result["Name"]);
                                $('#phone2').text("0" + result["Phone"]);
                                $('#btnOrder').show();
                                $('#divterms').show();
                            }
                            else if (result == "failed phone&pass") {
                                toastr.error('Phone or password is not correct or both!!', '', { timeOut: 7000 });
                            }
                            else {
                                //account exist with old address
                                $('#btncheckAcc').hide();
                                $('#checkedAccSuccess').show();
                                $('#checkedBefore').show();
                                $('#bigBlock').hide();
                                $('#addressOrNot').val(result["Address"]);
                                $('#oldAddress').text(result["Address"]);
                                $('#name').text(result["Name"]);
                                $('#phone').text("0"+result["Phone"]);
                                $('#btnOrder').show();
                                $('#divterms').show();
                            }
                            

                        }
                    });

                }
            });
            $('#btnOrder').click(function () {
                HideAllValidations();
                var fname = $('#fname').val();
                var lname = $('#lname').val();
                var telephone1 = $('#telephone1').val();
                var password1 = $('#password1').val();
                var city1 = $('#city1').val();
                var address1 = $('#address1').val();
                var telephone2 = $('#telephone2').val();
                var password2 = $('#password2').val();
                var city2 = $('#city2').val();
                var address2 = $('#address2').val();
                var city3 = $('#city3').val();
                var address3 = $('#address3').val();
                var city4 = $('#city4').val();
                var address4 = $('#address4').val();
                var city5 = $('#city5').val();
                var address5 = $('#address5').val();
                var AddressOrNot = $('#addressOrNot').val();
                var userId = $('#inputHidden').val();

                //login
                if (telephone2 == "" || telephone2 == undefined) {
                    $('#validphone11').show();
                }
                if (password2 == "" || password2 == undefined) {
                    $('#validpassword11').show();
                }
                //end

                //start create account
                if (fname == "" || fname == undefined) {
                    $('#validfname').show();
                }
                if (lname == "" || lname == undefined) {
                    $('#validlname').show();
                }
                if (telephone1 == "" || telephone1 == undefined) {
                    $('#validphone21').show();
                }
                if (password1 == "" || password1 == undefined) {
                    $('#validpassword21').show();
                }
                if (city1 == "" || city1 == undefined) {
                    $('#validcity21').show();
                }
                if (address1 == "" || address1 == undefined) {
                    $('#validaddress21').show();
                }

                //end

                //start write address if it's logined in
                if (city4 == "" || city4 == undefined) {
                    $('#validcity4').show();
                }
                if (address4 == "" || address4 == undefined) {
                    $('#validaddress4').show();
                }
                //end
                if (city5 == "" || city5 == undefined) {
                    $('#validcity5').show();
                }
                if (address5 == "" || address5 == undefined) {
                    $('#validaddress5').show();
                }

                if ((city3 == "" && address3 == "") || ((city3 != "" && city3 != undefined) && (address3 != "" && address3 != undefined))) {
                    //write new address (there is old address in sales table) while already signed in-->(if variables is null go and get the old address)
                    $.each(arr, function (key, item) {
                        dataArr[key] = { City: city3, Address: address3, ProductCode: item.productCode, UserID: userId, ProductQuantity: item.productQuantity, TotalPrice: item.totalPrice };
                    });
                    $.ajax({
                        type: "POST",
                        url: "/Home/CheckOut",
                        data: { OrderData: dataArr },
                        dataType: "json",
                        success: function (result) {
                            if (result == "success checked new address") {
                                toastr.success('Order checked successfully at the address you entered.', '', { timeOut: 7000 });
                                $.each(z, function (key, item) {
                                    removeItemStorage("Cart", 0);
                                });
                                var cart = getItemStorage("Cart") || [];
                                setItemStorage("Cart", cart);
                                $.each(nonavaialbleData, function (key, item) {
                                    addValueToItemStorage("Cart", item);
                                });

                                window.location = "/Home/Index"
                            }
                            else if (result == "success checked old address") {
                                toastr.success('Order checked successfully at the same address checked before.', '', { timeOut: 7000 });
                                $.each(z, function (key, item) {
                                    removeItemStorage("Cart", 0);
                                });
                                var cart = getItemStorage("Cart") || [];
                                setItemStorage("Cart", cart);
                                $.each(nonavaialbleData, function (key, item) {
                                    addValueToItemStorage("Cart", item);
                                });

                                window.location = "/Home/Index"
                            }

                        }
                    });
                }

                else if ((city4 != "" && city4 != undefined) && (address4 != "" && address4 != undefined)) {
                    //write new address for the first time while already signed in-->(add address)
                    $.each(arr, function (key, item) {
                        dataArr[key] = { City: city4, Address: address4, ProductCode: item.ProductCode, UserID: userId, ProductQuantity: item.ProductQuantity, TotalPrice: item.TotalPrice };

                    });
                    $.ajax({
                        type: "POST",
                        url: "/Home/CheckOut",
                        data: { OrderData: dataArr },
                        dataType: "json",
                        success: function (result) {
                            if (result == "success checked new address") {
                                toastr.success('Order checked successfully at the address you entered.', '', { timeOut: 7000 });
                                $.each(z, function (key, item) {
                                    removeItemStorage("Cart", 0);
                                });
                                var cart = getItemStorage("Cart") || [];
                                setItemStorage("Cart", cart);
                                $.each(nonavaialbleData, function (key, item) {
                                    addValueToItemStorage("Cart", item);
                                });
                                window.location = "/Home/Index"
                            }
                        }
                    });
                }
               else if (telephone1 == ""  && telephone2 == ""  && password1 == "" && password2 == ""  && city1 == "" && city2 == "" && address1 == "" && address2 == "" && fname == ""  && lname == "") {
                    Swal.fire({
                        icon: 'error',
                        title: 'Please log in or Create a new account !!',
                        showConfirmButton: false,
                        timer: 1500
                    })
                }
                else if (telephone2 == "" && password2 == "" && city2 == "" && address2 == "" && fname != "" && lname != "" && telephone1 != "" && password1 != "" && city1 != "" && address1 != "") {
                    //create Account
                    $.each(arr, function (key, item) {
                        dataArr[key] = { City: city1, Address: address1, ProductCode: item.ProductCode, ProductQuantity: item.ProductQuantity, TotalPrice: item.TotalPrice };
                    });
                    userArr = { FName: fname, LName: lname, Password: password1, Telephone: telephone1 }
                    $.ajax({
                        type: "POST",
                        url: "/Home/CheckOut",
                        data: { UserData: userArr, OrderData: dataArr },
                        datatype: "json",
                        success: function (result) {
                            if (result == "success") {
                                toastr.success('Account has been created & Order checked successfully.', '', { timeOut: 7000 });
                                $.each(z, function (key, item) {
                                    removeItemStorage("Cart", 0);
                                });
                                var cart = getItemStorage("Cart") || [];
                                setItemStorage("Cart", cart);
                                $.each(nonavaialbleData, function (key, item) {
                                    addValueToItemStorage("Cart", item);
                                });
                                window.location = "/Home/Index"
                            }
                            else if (result == "This phone is already exist") {
                                $("#validphone22").show();
                            }

                        }
                    });
                }
                else if ((telephone2 != "" && password2 != "" && fname == "" && lname == "" && telephone1 == "" && password1 == "" && city1 == "" && address1 == "" && city5 != "" && address5 != "" && city2 == "" && address2 == "" && AddressOrNot == "") || (telephone2 != "" && password2 != "" && fname == "" && lname == "" && telephone1 == "" && password1 == "" && city1 == "" && address1 == "" && city5 == "" && address5 == "" && AddressOrNot != "" ) ) {
                    //already have Account
                    if (city2 =="") {
                        $.each(arr, function (key, item) {
                            dataArr[key] = { City: city5, Address: address5, ProductCode: item.ProductCode, ProductQuantity: item.ProductQuantity, TotalPrice: item.TotalPrice };
                        });
                    }
                    else {
                        $.each(arr, function (key, item) {
                            dataArr[key] = { City: city2, Address: address2, ProductCode: item.ProductCode, ProductQuantity: item.ProductQuantity, TotalPrice: item.TotalPrice };
                        });
                    }
                    userArr = { Telephone: telephone2, Password: password2 }
                    $.ajax({
                        type: "POST",
                        url: "/Home/CheckOut",
                        data: { UserData: userArr, OrderData: dataArr },
                        dataType: "json",
                        success: function (result) {
                            if (result == "success checked new address") {
                                toastr.success('Order checked successfully at the address you entered.', '', { timeOut: 7000 });
                                $.each(z, function (key, item) {
                                    removeItemStorage("Cart", 0);
                                });
                                var cart = getItemStorage("Cart") || [];
                                setItemStorage("Cart", cart);
                                $.each(nonavaialbleData, function (key, item) {
                                    addValueToItemStorage("Cart", item);
                                });
                                window.location = "/Home/Index"
                            }
                            else if (result == "success checked old address") {
                                toastr.success('Order checked successfully at the same address checked before.', '', { timeOut: 7000 });
                                $.each(z, function (key, item) {
                                    removeItemStorage("Cart", 0);
                                });
                                var cart = getItemStorage("Cart") || [];
                                setItemStorage("Cart", cart);
                                $.each(nonavaialbleData, function (key, item) {
                                    addValueToItemStorage("Cart", item);
                                });
                                window.location = "/Home/Index"
                            }
                            else if (result == "failed phone") {
                                $("#validphone12").show();
                            }
                            else if (result == "failed password") {
                                $("#validpassword12").show();
                            }
                            else if (result == "failed phone&pass") {
                                toastr.error('Phone or password is not correct or both!!', '', { timeOut: 7000 });
                            }
                        }
                    });
                }
                
            });
            $('#terms').click(function () {
                if ($("#btnOrder").is(':disabled')) {
                    $("#btnOrder").removeAttr('disabled');
                    $("#btnOrder").css('background-color', '#D10024');
                }
                else {
                    $("#btnOrder").attr('disabled', 'disabled');
                    $("#btnOrder").css('background-color', 'darkgray');
                    $("#terms").removeAttr('checked');
                }
            });
            $('#btnaccept').click(function () {
                if ($("#btnOrder").is(':disabled')) {
                    $('#terms').prop('checked', true);
                    $("#btnOrder").removeAttr('disabled');
                    $("#btnOrder").css('background-color', '#D10024');

                }


            });
        });
        function HideAllValidations() {
            //start login
            $('#validphone11').hide();
            $('#validpassword11').hide();
            $('#validphone12').hide();
            $('#validpassword12').hide();
            //end

            //start create account
            $('#validfname').hide();
            $('#validlname').hide();
            $('#validphone21').hide();
            $('#validphone22').hide();
            $('#validpassword21').hide();
            $('#validcity21').hide();
            $('#validaddress21').hide();
            //end

            //start write address if it's logined in
            $('#validcity4').hide();
            $('#validaddress4').hide();
            //end
            $('#validcity5').hide();
            $('#validaddress5').hide();

        }
        function ClearCreateAccDiv() {
            setTimeout(function () {
                $('#fname').val('');
                $('#lname').val('');
                $('#address1').val('');
                $('#city1').val('');
                $('#telephone1').val('');
                $('#password1').val('');
            }, 1000);
            //start login
            $('#validphone11').hide();
            $('#validpassword11').hide();
            $('#validphone12').hide();
            $('#validpassword12').hide();
            //end login

            //start create account
            $('#validfname').hide();
            $('#validlname').hide();
            $('#validphone21').hide();
            $('#validphone22').hide();
            $('#validpassword21').hide();
            //end create account
        }
        function ClearHaveAccDiv() {
            setTimeout(function () {
                $('#password2').val('');
                $('#address2').val('');
                $('#city2').val('');
                $('#telephone2').val('');
            }, 1000);
            //start login
            $('#validphone11').hide();
            $('#validpassword11').hide();
            $('#validphone12').hide();
            $('#validpassword12').hide();
            //end login

            //start create account
            $('#validfname').hide();
            $('#validlname').hide();
            $('#validphone21').hide();
            $('#validphone22').hide();
            $('#validpassword21').hide();
            //end create account
        }

        function setItemStorage(itemKey, itemValue) {
            localStorage.setItem(itemKey, JSON.stringify(itemValue));
        }
        function getItemStorage(itemKey) {
            return JSON.parse(localStorage.getItem(itemKey));
        }
        function removeItemStorage(itemKey, val) {
            let item = getItemStorage(itemKey);
            item.splice(val, 1);
            setItemStorage(itemKey, item);
        }
    </script>
</body>
</html>